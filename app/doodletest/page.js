"use client";
import { useState, useEffect } from "react";
import Link from "next/link";
import Image from "next/image";
import confetti from "canvas-confetti";
import FooterLink from "../../components/FooterLink";
import { loadSound, playSound } from "../../utils/audio"; // ‚úÖ –Ω–æ–≤—ã–π –∑–≤—É–∫

/* === –í–û–ü–†–û–°–´ === */
const QUESTIONS = [
  {
    text: "–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –≤ —Å—Ç—Ä–æ—á–∫–µ ¬´... –≤—Ä–∞–≥–∞–º –ö—É–±–∞–Ω–∏¬ª?",
    answers: ["–ë—É–π", "–ú–∏—Ä", "–ú—è—á", "–•—É–π"],
    correct: "–•—É–π",
  },
  {
    text: "–í–æ —Å–∫–æ–ª—å–∫–æ –≥–µ—Ä–æ–π –ø–µ—Å–Ω–∏ ¬´–ü–∏–≤–∞—Å–∏–∫¬ª –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –ø–æ–¥—ä–µ–∑–¥–∞?",
    answers: ["7:40", "11:00", "9:30", "18:10"],
    correct: "9:30",
  },
  {
    text: "–í –∫–∞–∫–æ–µ –Ω–µ–±–æ —Å–º–æ—Ç—Ä–µ–ª–∞ –≥–µ—Ä–æ–∏–Ω—è –ø–µ—Å–Ω–∏ ¬´–ó–µ—Ä–∫–∞–ª—å—Ü–µ¬ª?",
    answers: ["–ì–æ–ª—É–±–æ–µ", "–í–µ—Å–µ–Ω–Ω–µ–µ", "–ê—É—Å—Ç–µ—Ä–ª–∏—Ü–∞", "–û—Å–µ–Ω–Ω–µ–µ"],
    correct: "–û—Å–µ–Ω–Ω–µ–µ",
  },
  {
    text: "–ö–∞–∫–æ–π –≠–ª–≤–∏—Å —Å–¥–æ—Ö–Ω–µ—Ç –≤ –±–æ–ª—å–Ω–∏—Ü–µ?",
    answers: ["–°—Ç–∞—Ä—ã–π, –∂–∏—Ä–Ω—ã–π", "–°—Ç–∏–ª—å–Ω—ã–π, –º–æ–¥–Ω—ã–π", "–°—Ç–∞—Ä—ã–π, —Ç–æ–ª—Å—Ç—ã–π", "–•—É–¥–æ–π, –±–æ–ª—å–Ω–æ–π"],
    correct: "–°—Ç–∞—Ä—ã–π, —Ç–æ–ª—Å—Ç—ã–π",
  },
  {
    text: "–ö–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ—Ä–æ–π –ø–µ—Å–Ω–∏ ¬´–¢—Ä–µ—â–∏–Ω–∫–∞¬ª?",
    answers: ["–ü–µ–≤—Ü–æ–º", "–ü—Ä–æ–¥–∞–≤—Ü–æ–º", "–ö—É–ø—Ü–æ–º", "–ù–∏–∫–µ–º"],
    correct: "–ù–∏–∫–µ–º",
  },
  {
    text: "–£–±–µ—Ä–∏ –ª–∏—à–Ω—é—é —Å—Ç—Ä–æ—á–∫—É –∏–∑ –ø–µ—Å–Ω–∏ ¬´–í—Å—ë —Ö–æ—Ä–æ—à–æ¬ª.",
    answers: [
      "–í —ç—Ç–æ–π –ø–µ—Å–Ω–µ –Ω–µ –±—É–¥–µ—Ç —Ç–µ—Ä–∑–∞–Ω–∏–π",
      "–í –ø–µ—Å–Ω–µ –Ω–µ –±—É–¥–µ—Ç –ª–∏—Ä–∏—á–Ω—ã—Ö –≥–µ—Ä–æ–µ–≤",
      "–ù–µ –±—É–¥–µ—Ç –ª—é–±–æ–≤–Ω—ã—Ö –ø–∏–∑–¥–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–π",
      "–í –ø–µ—Å–Ω–µ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–º—ë–∫–æ–≤ –Ω–∞ –≥–µ–µ–≤",
    ],
    correct: "–í –ø–µ—Å–Ω–µ –Ω–µ –±—É–¥–µ—Ç –Ω–∞–º—ë–∫–æ–≤ –Ω–∞ –≥–µ–µ–≤",
  },
  {
    text: "–ö–∞–∫–∞—è —Å—Ç—Ä–æ—á–∫–∞ –µ—Å—Ç—å –≤ –ø–µ—Å–Ω–µ ¬´–°—Ç–∞—Ä–∏–∫ –§—É—Ä–∞¬ª?",
    answers: [
      "–û—Ç–≤–µ—Å–∏–≤ –æ–ø–ª–µ—É—Ö—É –≥–∞–¥—É –ü–∞—Å–ø–∞—Ä—Ç—É",
      "–ü–æ —É—Ö—É —Ç—Ä–µ—Å–Ω—É–ª–∏ –º–µ–Ω—è –≤—á–µ—Ä–∞ –≤ –ø–æ—Ä—Ç—É",
      "–ó–∞—Å—É–Ω—É–ª –∫–∞—Ä–ª–∏–∫–∞ —Å—Ç–∞—Ä–∏–∫ –≤ –Ω–æ—Ä—É –∫ –∫—Ä–æ—Ç—É",
      "–ö–∞–∫ –±—É–¥—Ç–æ –∫–∞—Ä–ª–∏–∫–∏ –Ω–∞—Å—Ä–∞–ª–∏ —É –º–µ–Ω—è –≤–æ —Ä—Ç—É",
    ],
    correct: "–û—Ç–≤–µ—Å–∏–≤ –æ–ø–ª–µ—É—Ö—É –≥–∞–¥—É –ü–∞—Å–ø–∞—Ä—Ç—É",
  },
  {
    text: "–ü—Ä–æ–¥–æ–ª–∂–∏ —Å—Ç—Ä–æ—á–∫—É: ¬´–ê –±—ã–ª–∞ –±—ã –ò—Ä–∞...¬ª",
    answers: ["–±—ã–ª –±—ã –±–æ—Ä—â", "–±—ã–ª –±—ã —Ö—É–π", "–±—ã–ª –±—ã —Å–µ–∫—Å", "—è –±—ã —Å–ø–µ–ª"],
    correct: "–±—ã–ª –±—ã —Å–µ–∫—Å",
  },
  {
    text: "–ß–µ–º –º—ã –∫–æ—Ä–º–∏–º ¬´–±–æ–ª—å—à—É—é –∏ –∑–ª—É—é –º–∞—à–∏–Ω—É¬ª?",
    answers: ["–ë–µ–Ω–∑–∏–Ω–æ–º", "–ü–∏—Ä–æ–∂–∫–∞–º–∏", "–î–µ–Ω—å–≥–∞–º–∏", "–®–∞—É—Ä–º–æ–π"],
    correct: "–î–µ–Ω—å–≥–∞–º–∏",
  },
  {
    text: "–¢—ã –≤ –¥—É—à–µ –∏—Ä–ª–∞–Ω–¥–µ—Ü, –µ—Å–ª–∏ –≤ –∫–æ–Ω—Ü–µ –≤–µ—á–µ—Ä–∞ –ø—å—ë—à—å:",
    answers: ["–ì–∏–Ω–Ω–µ—Å—Å", "–í–∏—Å–∫–∏", "–í–æ–¥–∫—É", "–í–µ—Ä–º—É—Ç"],
    correct: "–í–µ—Ä–º—É—Ç",
  },
  {
    text: "–ß—Ç–æ —á–∏—Ç–∞–ª –≥–µ—Ä–æ–π –ø–µ—Å–Ω–∏ ¬´–û—Ñ–∏—Å¬ª?",
    answers: ["–¢—Ä—É–¥–æ–≤–æ–π –∫–æ–¥–µ–∫—Å", "–ù–∞–¥–ø–∏—Å–∏ –Ω–∞ –∑–∞–±–æ—Ä–µ", "–ë–æ–π—Ü–æ–≤—Å–∫–∏–π –∫–ª—É–±", "–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ–± —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏"],
    correct: "–ë–æ–π—Ü–æ–≤—Å–∫–∏–π –∫–ª—É–±",
  },
  {
    text: "–ö–∞–∫–æ–π —É –≥—Ä—É–ø–ø—ã Doodle –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ö–µ—à—Ç–µ–≥ –ø–æ–º–∏–º–æ #doodle_music?",
    answers: [
      "#–ø–µ—Å–Ω–∏–ø—Ä–æ–≤–∏–Ω–æ–∏–≤–æ–¥–∫—É",
      "#–ø–µ—Å–Ω–∏–ø–ª—è—Å–∫–∏—Å–∏—Å—å–∫–∏–ø–∏—Å—å–∫–∏",
      "#–ø–µ—Å–Ω–∏–ø—Ä–æ–ª—é–±–æ–≤—å–∏–∂–æ–ø—É",
      "#–ø—å–µ–º—Ç–∞—Ü—É–µ–º—É—Ç—Ä–æ–º–ø–ª–æ—Ö–æ",
    ],
    correct: "#–ø–µ—Å–Ω–∏–ø—Ä–æ–ª—é–±–æ–≤—å–∏–∂–æ–ø—É",
  },
  {
    text: "–ù–∞ –∫–∞–∫–æ–º –º—É–∑—ã–∫–∞–ª—å–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ –∏–≥—Ä–∞–µ—Ç –°–∞—à–∞ –∏–∑ Doodle?",
    answers: ["–ë–∞—Ä–∞–±–∞–Ω—ã", "–¢—Ä—É–±–∞", "–ë–∞—Å", "–ë—É–±–µ–Ω"],
    correct: ["–ë–∞—Ä–∞–±–∞–Ω—ã", "–ë–∞—Å", "–ë—É–±–µ–Ω"],
  },
  {
    text: "–ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–≥–Ω–∞—Ç—å –≤ –ø–µ—Å–Ω–µ ¬´–¢–µ–ª–µ–ø–æ—Ä—Ç¬ª?",
    answers: ["–ü—ë—Å –∏–∑ –ø–æ–¥–≤–æ—Ä–æ—Ç–Ω–∏", "–¢—ë—Ç–µ–Ω—å–∫–∞ —Å –∫–æ—Å–æ–π", "–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π –≤ —à—Ç–∞—Ç—Å–∫–æ–º", "–ú–æ—Ä—Ç–∏ –∏ –†–∏–∫ –°–∞–Ω—á–µ—Å"],
    correct: "–¢—ë—Ç–µ–Ω—å–∫–∞ —Å –∫–æ—Å–æ–π",
  },
  {
    text: "–î–∏–º–∞ –ø—Ä–∏–Ω—ë—Å –≤ –≥—Ä—É–ø–ø—É –Ω–æ–≤—É—é –ø–µ—Å–Ω—é. –ö–∞–∫–æ–µ —É –Ω–µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ?",
    answers: ["¬´–ú–∏–ª—Ñ—ã-—Å–∞–º–æ–∫–∞—Ç—á–∏—Ü—ã¬ª", "¬´–ö–∞—Ä–ª–∏—Ü—ã-–≤–µ–±–∫–∞–º—â–∏—Ü—ã¬ª", "¬´–≠—Å–∫–æ—Ä—Ç–Ω–∏—Ü—ã-–Ω–∞—Ä–æ–¥–Ω–∏—Ü—ã¬ª", "¬´–¢—è–Ω–∫–∏-–ª–µ—Å–±–∏—è–Ω–∫–∏¬ª"],
    correct: "¬´–ö–∞—Ä–ª–∏—Ü—ã-–≤–µ–±–∫–∞–º—â–∏—Ü—ã¬ª",
  },
];

/* === –†–ï–ó–£–õ–¨–¢–ê–¢–´ === */
function getResult(score) {
  if (score <= 3) {
    return {
      text: `–¢—ã –∑–∞—è—Ü. –ó–∞—à—ë–ª –≤ —Ç—Ä–∞–º–≤–∞–π –±—É–∫–≤–∞–ª—å–Ω–æ –Ω–∞ –ø–∞—Ä—É –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –∏ –≤—ã—Å–∫–æ—á–∏–ª –Ω–µ –æ–ø–ª–∞—Ç–∏–≤ –ø—Ä–æ–µ–∑–¥. 
–ù–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ç–µ–±–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–∞—à–∏–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º –∏ —Å—Ç–∞—Ç—å –Ω–∞—à–∏–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º –ø–∞—Å—Å–∞–∂–∏—Ä–æ–º.`,
      image: "/doodle/gay.png",
    };
  } else if (score <= 7) {
    return {
      text: `–¢—ã —Ç–æ—Ç —Å–∞–º—ã–π –ø–∞—Å—Å–∞–∂–∏—Ä –∫–æ—Ç–æ—Ä—ã–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ –ø—É—Ç–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–ª—É—à–∞–µ—Ç –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö –ø–µ—Å–Ω–∏ –≥—Ä—É–ø–ø—ã Doodle. 
–ú–æ–∂–µ—Ç —Ç—ã –∏ –Ω–µ –∑–Ω–∞–µ—à—å –≤—Å–µ —Ç–µ–∫—Å—Ç—ã –Ω–∞–∏–∑—É—Å—Ç—å, –Ω–æ —Ç–æ—á–Ω–æ –ø–æ–¥–ø–µ–≤–∞–µ—à—å –ø—Ä–∏–ø–µ–≤—ã –∏ –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—á–∞–µ—à—å, —á—Ç–æ —Ç–µ–±—è —Å–ª—ã—à–∞—Ç –≤—Å–µ –≤–æ–∫—Ä—É–≥.`,
      image: "/doodle/office.png",
    };
  } else if (score <= 11) {
    return {
      text: `–¢—ã —Ç–∞ —Å–∞–º–∞—è –±–∞–±–∫–∞ –≤ —Ç—Ä–∞–º–≤–∞–µ, –∫–æ—Ç–æ—Ä–∞—è —Å–∞–¥–∏—Ç—Å—è –≤ –Ω–µ–≥–æ —Å —Å–∞–º–æ–≥–æ —Ä–∞–Ω–Ω–µ–≥–æ —É—Ç—Ä–∞ –∏ –º–æ—Ç–∞–µ—Ç—Å—è –æ—Ç –∫–æ–Ω–µ—á–Ω–æ–π –¥–æ –∫–æ–Ω–µ—á–Ω–æ–π –≤–µ—Å—å –¥–µ–Ω—å. 
–í—Å–µ –ø–µ—Å–Ω–∏ —Ç–µ–±–µ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–∫–æ–º—ã. –¢—ã –≤–æ—Ä—á–∏—à—å –Ω–∞ —Ç–µ—Ö –∫—Ç–æ –Ω–µ–∑–Ω–∞–∫–æ–º —Å –Ω–∞—à–∏–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–∫–∏–¥—ã–≤–∞–µ—à—å —Å—Å—ã–ª–∫–∏ —Å–≤–æ–∏–º –¥—Ä—É–∑—å—è–º —Å–æ —Å–ª–æ–≤–∞–º–∏ ¬´–í—ã –Ω–µ —Å–ª—ã—à–∞–ª–∏? –ß—Ç–æ –∑–∞ –º–æ–ª–æ–¥–µ–∂—å –ø–æ—à–ª–∞¬ª.`,
      image: "/doodle/gran.png",
    };
  } else if (score <= 14) {
    return {
      text: `–¢—ã –∫–æ–Ω–¥—É–∫—Ç–æ—Ä. Doodle –¥–ª—è —Ç–µ–±—è –∏ –¥–æ–º –∏ —Å–µ–º—å—è –∏ —Ä–∞–±–æ—Ç–∞. 
–¢—ã –∑–Ω–∞–µ—à—å –≤—Å–µ—Ö –≤ –≤–∞–≥–æ–Ω–µ. –õ–µ–≥–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—à—å –∑–∞–π—Ü–µ–≤ –∏ —à—Ç—Ä–∞—Ñ—É–µ—à—å –∏—Ö. 
–¢—ã –∑–Ω–∞–µ—à—å –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞—à–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –Ω–æ –∏ –Ω–∞—à–∏ –∏–º–µ–Ω–∞. –î–∞–∂–µ –µ—Å–ª–∏ –º—ã –ø–æ–º–µ–Ω—è–µ–º—Å—è –Ω–∞ —Å—Ü–µ–Ω–µ –º–µ—Å—Ç–∞–º–∏. 
–ü–æ—á—Ç–∏ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞ —Ç—ã —Å–æ—Å—Ç–æ–∏—à—å –≤ –Ω–∞—à–µ–º —Ñ–∞–Ω –¥–≤–∏–∂–µ–Ω–∏–∏ –û–ü–ì Doodle. 
–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—à—å –∫–æ–Ω—Ü–µ—Ä—Ç—ã –∏ –∑–∞ —ç—Ç–æ –º—ã —Ç–µ–±—è —Ç–∞–∫ –ª—é–±–∏–º.`,
      image: "/doodle/conductor.png",
    };
  } else {
    return {
      text: `–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –≤–æ–¥–∏—Ç–µ–ª—å —Ç—Ä–∞–º–≤–∞—è! –ü–æ –≤—Å–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç—ã —É—á–∞—Å—Ç–Ω–∏–∫ –≥—Ä—É–ø–ø—ã. 
–ü–æ—Ç–æ–º—É —á—Ç–æ 15 –∏–∑ 15 –Ω–∞–±–µ—Ä–µ—Ç –Ω–µ –∫–∞–∂–¥—ã–π –Ω–∞—à –º—É–∑—ã–∫–∞–Ω—Ç. 
–ú—ã –¥–∞–∂–µ –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–∂–∏–≤–∞–µ–º‚Ä¶ –ú–æ–∂–µ—Ç —Ç–µ–±–µ –ø–æ—Å–ª—É—à–∞—Ç—å –∏ –¥—Ä—É–≥–∏–µ –≥—Ä—É–ø–ø—ã? 
–¢—ã –∂–µ –Ω–µ —Å–ª–µ–¥–∏—à—å –∑–∞ –Ω–∞–º–∏ –∏–∑ —Ç–µ–º–Ω—ã—Ö –ø–µ—Ä–µ—É–ª–∫–æ–≤? 
–°–∫–∞–∂–∏ —á–µ—Å—Ç–Ω–æ, —ç—Ç–æ —Ç—ã —Ç–æ–≥–¥–∞ –º–æ–ª—á–∞–ª –∏ –¥—ã—à–∞–ª –≤ —Ç—Ä—É–±–∫—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞? 
–õ–∞–¥–Ω–æ! –≠—Ç–æ –º—ã —Ç–∞–∫ —à—É—Ç–∏–º. –¢—ã –≤–µ—Ä–Ω—ã–π –∏ –ø—Ä–µ–¥–∞–Ω–Ω—ã–π —Ñ–∞–Ω–∞—Ç, –ø—É—Å—Ç—å –∏ –Ω–µ–º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–Ω—ã–π. 
–•–æ—Ç—è –∫—Ç–æ —Ç—É—Ç –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π? –ñ–¥–µ–º —Ç–µ–±—è –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–º –∫–æ–Ω—Ü–µ—Ä—Ç–µ. –ë—É–¥–µ–º –æ–±–Ω–∏–º–∞—Ç—å—Å—è!`,
      image: "/doodle/driver.png",
    };
  }
}

/* === shuffle === */
function shuffleArray(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

export default function DoodleTest() {
  const [started, setStarted] = useState(false);
  const [step, setStep] = useState(0);
  const [score, setScore] = useState(0);
  const [shuffledAnswers, setShuffledAnswers] = useState([]);

  const current = QUESTIONS[step];

  useEffect(() => {
    if (current) setShuffledAnswers(shuffleArray(current.answers));
  }, [step]);

  useEffect(() => {
    loadSound("click", "/sound/click.ogg");
  }, []);

  const handleAnswer = (answer) => {
    playSound("click");
    const isCorrect =
      (Array.isArray(current.correct) && current.correct.includes(answer)) ||
      answer === current.correct;
    if (isCorrect) setScore((s) => s + 1);
    setStep((s) => s + 1);
  };

  const restart = () => {
    playSound("click");
    setStarted(false);
    setStep(0);
    setScore(0);
  };

  /* üéâ –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
  useEffect(() => {
    if (step === QUESTIONS.length && started) {
      const duration = 4000;
      const end = Date.now() + duration;
      (function frame() {
        confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 } });
        confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 } });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }
  }, [step, started]);

  return (
    <div className="min-h-screen bg-black text-white flex flex-col items-center justify-start pt-16 pb-32 px-4 sm:px-6">
      {/* –∫—Ä–µ—Å—Ç–∏–∫ */}
      <Link
        href="/"
        className="fixed top-4 right-6 text-white text-xl sm:text-2xl md:text-3xl font-bold hover:text-red-400 transition"
      >
        ‚úï
      </Link>

      {/* üöã —Ç—Ä–∞–º–≤–∞–π */}
      {(!started || step < QUESTIONS.length) && (
        <div className="w-full flex justify-center mb-6">
          <Image src="/doodle/tram.png" alt="–¢—Ä–∞–º–≤–∞–π Doodle" width={160} height={110} priority
            className="max-w-[50%] sm:max-w-[160px] h-auto" />
        </div>
      )}

      {!started ? (
        <div className="max-w-2xl text-center">
          <h1 className="text-xl sm:text-2xl md:text-3xl font-bold mb-4">
            –¢–µ—Å—Ç –Ω–∞ –∑–Ω–∞–Ω–∏–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ –≥—Ä—É–ø–ø—ã Doodle
          </h1>
          <p className="mb-6 text-sm sm:text-base md:text-lg">
            –î–∞–≤–∞–π —É–∑–Ω–∞–µ–º, –∫—Ç–æ —Ç—ã –≤ —Ç—Ä–∞–º–≤–∞–µ, –∫–æ—Ç–æ—Ä—ã–π –µ–¥–µ—Ç –ø–æ –¥–µ—Å—è—Ç–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É
          </p>
          <button
            onClick={() => { playSound("click"); setStarted(true); }}
            className="px-3 sm:px-4 md:px-6 py-2 sm:py-2.5 md:py-3 rounded-lg bg-white/20 hover:bg-white/30 transition text-sm sm:text-base md:text-lg"
          >
            –ü–æ–µ—Ö–∞–ª–∏
          </button>
        </div>
      ) : step < QUESTIONS.length ? (
        <div className="max-w-xl text-center">
          <p className="mb-4 text-xs sm:text-sm md:text-base text-gray-400">
            –í–æ–ø—Ä–æ—Å {step + 1} –∏–∑ {QUESTIONS.length}
          </p>
          <h2 className="text-base sm:text-lg md:text-xl font-bold mb-6">{current.text}</h2>
          <div className="flex flex-col gap-3">
            {shuffledAnswers.map((a, i) => (
              <button
                key={i}
                onClick={() => handleAnswer(a)}
                className="px-3 sm:px-4 md:px-6 py-2 sm:py-2.5 md:py-3 rounded-lg bg-white/10 hover:bg-white/20 transition text-sm sm:text-base md:text-lg"
              >
                {a}
              </button>
            ))}
          </div>
        </div>
      ) : (
        (() => {
          const result = getResult(score);
          return (
            <div className="max-w-2xl text-center">
              <h2 className="text-xl sm:text-2xl md:text-3xl font-bold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
              <p className="mb-2 text-sm sm:text-base md:text-lg">
                –¢—ã –Ω–∞–±—Ä–∞–ª <b>{score}</b> –∏–∑ {QUESTIONS.length}
              </p>
              <div className="flex justify-center mb-6">
                <Image src={result.image} alt="—Ä–µ–∑—É–ª—å—Ç–∞—Ç" width={200} height={200}
                  className="max-w-[150px] sm:max-w-[200px] h-auto" />
              </div>
              {/* ‚ùó –¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º –±–µ–∑ –∞–±–∑–∞—Ü–µ–≤ */}
              <p className="mb-6 text-sm sm:text-base md:text-lg">
                {result.text.replace(/\s*\n\s*/g, " ")}
              </p>
              <a href="https://t.me/doodle_music" target="_blank" rel="noopener noreferrer"
                 className="text-blue-400 underline hover:text-blue-600 block mb-4 text-sm sm:text-base">
                –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ Telegram
              </a>
              <button
                onClick={restart}
                className="px-3 sm:px-4 md:px-6 py-2 sm:py-2.5 md:py-3 rounded-lg bg-white/20 hover:bg-white/30 transition text-sm sm:text-base md:text-lg"
              >
                –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑
              </button>
            </div>
          );
        })()
      )}

      {/* ‚ö°Ô∏è –§—É—Ç–µ—Ä */}
      <div className="fixed bottom-0 left-0 w-full pb-[env(safe-area-inset-bottom)] z-50">
        <FooterLink />
      </div>
    </div>
  );
}
